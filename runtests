#! /usr/bin/env python
import sys
import os
import os.path
import crds
from crds import config, log

os.chdir(os.path.dirname(sys.argv[0]) or ".")
topdir = os.getcwd()

# Unlike historical CRDS with builtin cache,  test cache is now a separate dedicated entity
# which contains mutated but otherwise same named mutated files.
# os.environ["CRDS_MAPPATH"] = os.path.join(os.getcwd(), "..", "crds_cache_archive", "mappings")
os.environ["CRDS_TESTING_CACHE"] = os.path.join(os.getcwd(), "..", "crds-cache-test")

os.system("python -m crds.sync --all --stats --log-time")
os.system("./install")
# os.system("nosetests --with-coverage --cover-html --cover-html-dir={0}/coverage --cover-branches --cover-package=crds --cover-erase".format(topdir))
os.system("nosetests")
os.system("python -m crds.list --config --log-time")
