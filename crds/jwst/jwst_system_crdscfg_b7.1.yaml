#
# This reference is used by the CRDS reprocessing recommendation system to define: 
#
# 1. The calibration code pipelines (.cfg files) nominally used for each EXP_TYPE for 
# applicable levels of data.
#
# 2. The reference types required to process each EXP_TYPE.
# 
# This file contains a combination of MANUAL inputs used by the generation algorithms
# to create the fields used at runtime:  exptypes_to_pipelines and exptypes_to_reftypes.
#
# Regeneration is performed by updating the MANUAL sections of a reference file
# and installing applicable calibration code and then doing:
#
# $ python -m crds.jwst.gen_system_crdscfg  old_reference.yaml  > new_reference.yaml
#
# The update concept is to take the last good reference,  modify the MANUAL inputs
# as appropriate,  then do the above to complete the regeneration process.
#
# HOWEVER:  If at some stage it becomes difficult to regenerate automatically,  the only
# fields used functionally for reprocessing are exptypes_to_pipelines and exptypes_to_reftypes.
# Thus it should be possible to substitute direct edits to those fields for automatic generation
# if automatic generation becomes problematic.
#

meta:
    author: CRDS
    description: "Used to determine cal code pipeline sequences and reference types for CRDS reprocessing."
    history: "Generated from calibration code .cfg files and EXP_TYPE/LEVEL mapping."
    instrument: SYSTEM
    pedigree: GROUND
    reftype: CRDSCFG
    telescope: JWST
    useafter: 1900-01-01T00:00:00
    calibration_software_version: 0.7.7
    crds_version: 7.1.5
    generation_date: 2017-08-09T00:00:00

# ----------------------------------------------------------------------------------------------
# MANUAL UPDATE REQUIRED
#
# Exhastive list of pipeline .cfg's to process for steps and reftypes during generation.
#
# ----------------------------------------------------------------------------------------------

pipeline_cfgs: [calwebb_dark.cfg, calwebb_sloper.cfg, calwebb_spec2.cfg, calwebb_image2.cfg]

# ----------------------------------------------------------------------------------------------
# MANUAL UPDATE REQUIRED
#
# Exhastive list of exp_type values
#
# ----------------------------------------------------------------------------------------------

exp_types:  [FGS_DARK, FGS_FOCUS, FGS_IMAGE, FGS_INTFLAT, FGS_SKYFLAT,
              MIR_IMAGE, MIR_TACQ, MIR_LYOT, MIR_4QPM, MIR_LRS-FIXEDSLIT,
              MIR_LRS-SLITLESS, MIR_MRS, MIR_DARK, MIR_FLAT-IMAGE, MIR_FLATIMAGE,
              MIR_FLAT-MRS, MIR_FLATMRS, MIR_CORONCAL, NIS_AMI, NIS_DARK,
              NIS_FOCUS, NIS_IMAGE, NIS_LAMP, NIS_SOSS, NIS_TACQ, NIS_TACONFIRM,
              NIS_WFSS, NRC_IMAGE, NRC_GRISM, NRC_TACQ, NRC_CORON,
              NRC_FOCUS, NRC_DARK, NRC_FLAT, NRC_LED, NRC_WFSC, NRC_TACONFIRM,
              NRC_TSIMAGE, NRC_TSGRISM, NRS_AUTOFLAT, NRS_AUTOWAVE, NRS_BOTA,
              NRS_BRIGHTOBJ, NRS_CONFIRM, NRS_DARK, NRS_FIXEDSLIT, NRS_FOCUS,
              NRS_IFU, NRS_IMAGE, NRS_LAMP, NRS_MIMF, NRS_MSASPEC, NRS_TACONFIRM,
              NRS_TACQ, NRS_TASLIT]

# ----------------------------------------------------------------------------------------------
# MANUAL UPDATE REQUIRED
#
# Order is important since the first pattern matching an exp_type in any given level wins.
#
# For each level, CRDS searches for a matching EXP_TYPE using glob matching,  searching
# in order from top to bottom, using the first match only.   Each level will contribute one 
# .cfg for a given EXP_TYPE.
#
# skip_2b.cfg is a placeholder with no steps.
# ----------------------------------------------------------------------------------------------

level_pipeline_exptypes:
    level2a:
        - calwebb_dark.cfg: [FGS_DARK, MIR_DARK, NRC_DARK, NIS_DARK, NRS_DARK]

        - calwebb_sloper.cfg: ["*"]

    level2b:
        - calwebb_spec2.cfg: [MIR_LRS-FIXEDSLIT, MIR_LRS-SLITLESS, MIR_MRS, NRS_FIXEDSLIT, 
                             NRS_MSASPEC, NRS_IFU, NRS_BRIGHTOBJ, NRS_AUTOWAVE, NIS_SOSS]

        - calwebb_image2.cfg: [NRC_IMAGE, NRC_TACQ, NRC_CORON, NRC_FOCUS, 
                             MIR_IMAGE, MIR_TACQ, MIR_LYOT, MIR_4QPM, MIR_CORONCAL,
                             NIS_IMAGE, NIS_AMI, NIS_TACQ,
                             NRS_IMAGE, NRS_FOCUS, NRS_MIMF, NRS_BOTA, NRS_TACQ, NRS_TASLIT, NRS_TACONFIRM, NRS_CONFIRM,
                             FGS_IMAGE, FGS_FOCUS]

        - skip_2b.cfg: ["*DARK*", "*FLAT*", "*LED*", "*LAMP*", NIS_FOCUS, NIS_WFSS, NRS_AUTOWAVE]

# ----------------------------------------------------------------------------------------------
#
# MANUAL UPDATE REQUIRED
#
# This section defines types for exceptional steps that do not use all of their defined types 
# depending on EXP_TYPE.
#
# CRDS searches the cases top-to-bottom looking for an EXP_TYPE that glob-matches and 
# returns the first match.  The return value is used instead of the value from steps_to_reftypes.
#
# ----------------------------------------------------------------------------------------------

steps_to_reftypes_exceptions:
    flat_field:
        - case1:
            exp_types: [NRS_FIXEDSLIT, NRS_IFU, NRS_MSASPEC, NRS_BRIGHTOBJ]
            reftypes: [dflat, fflat, sflat]
        - case2:
            exp_types: ["NRS_*"]
            reftypes: []
        - case3:
            exp_types: ["*"]
            reftypes: [flat]

# ----------------------------------------------------------------------------------------------
#
# AUTOMATICALLY GENERATED (or... was anyway) from here down
#
# This section defines mappings generated by reflecting on the JWST cal code distribution
#
# ----------------------------------------------------------------------------------------------
# vvvvvvvv GENERATED vvvvvvvv
