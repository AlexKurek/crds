#! /usr/bin/env  pysh
#-*-python-*-

from collections import defaultdict
from pprint import pprint

usage("<PRD subarray file>", 1,  1,"""

Reduce a PRD subarray file into a dictionary of valid subarrays
which are organized by instrument.
""")

% grep -E 'Instrument\>|Subarray\>' $* | cut -d '>' -f 2 | cut -d '<' -f 1 > simplified

organized = defaultdict(set)
with open("simplified") as file:
     instrument = file.readline().strip()
     while instrument:
           subarray = file.readline().strip()
           organized[instrument].add(subarray)
           instrument = file.readline().strip()

reorganized = dict()
for instrument in organized:
     reorganized[instrument] = sorted(list(organized[instrument]))

pprint(reorganized)

% rm simplified

